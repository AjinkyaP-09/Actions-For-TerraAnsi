# 🚀 Terraform & Ansible Docker Deployment with GitHub Actions

This repository provides a robust CI/CD pipeline that provisions an AWS EC2 instance, installs Docker on it using Ansible, and manages the entire lifecycle (creation and destruction) through GitHub Actions.

---

## 📘 Project Overview

This project automates infrastructure provisioning and configuration using:

- **Terraform**: Define and provision AWS EC2 infrastructure.
- **Ansible**: Configure EC2 instance and install Docker.
- **GitHub Actions**: Automate the entire CI/CD pipeline.
- **Docker**: Target application environment.
  
With a simple Git push or manual trigger, you get a fully Docker-ready EC2 instance on AWS.

---

## ✨ Features

- **Automated EC2 Provisioning**: Launch an Ubuntu EC2 instance in the default VPC.
- **Dynamic Security Group**: Allow SSH access (port 22) automatically.
- **SSH Key Management**: Terraform manages key pairs; Ansible uses private key via GitHub Secrets.
- **Docker Installation**: Ansible installs Docker Engine, CLI, Containerd, and Compose.
- **Full Lifecycle Automation**: Create and destroy infrastructure via GitHub Actions.
- **Secure Credentials**: AWS credentials and SSH private keys handled via GitHub Secrets.

---

## 🛠️ Technologies Used

- **Infrastructure as Code**: HashiCorp Terraform
- **Configuration Management**: Ansible
- **Cloud Provider**: Amazon Web Services (AWS)
- **CI/CD**: GitHub Actions
- **Containerization**: Docker

---

## 🔐 Prerequisites

Before you begin, ensure the following:

- ✅ An **active AWS account** with programmatic access (Access key ID + Secret).
- ✅ A **GitHub repository** where the workflows will run.
- ✅ A **public/private SSH key pair** for SSH access.

---

## ⚙️ Setup Instructions

### 1. Generate SSH Key Pair

```
ssh-keygen -t rsa -b 4096 -f ~/.ssh/github-actions-aws-key
 ```


This will create two files: `~/.ssh/github-actions-aws-key` (private key) and `~/.ssh/github-actions-aws-key.pub` (public key).

### 2. Configure GitHub Secrets

In your GitHub repository, go to **Settings > Secrets and variables > Actions** and add the following repository secrets:

- **AWS_ACCESS_KEY_ID**: Your AWS access key ID.
- **AWS_SECRET_ACCESS_KEY**: Your AWS secret access key.
- **SSH_PRIVATE_KEY**: The entire content of your generated private SSH key (`~/.ssh/github-actions-aws-key`). Make sure to copy the content including the `-----BEGIN RSA PRIVATE KEY-----` and `-----END RSA PRIVATE KEY-----` lines.

### 3. Place Public SSH Key in Repository

Create a file named `ssh-key.pub` in the root of your repository (the same directory as `main.tf`). Paste the entire content of your public SSH key (`~/.ssh/github-actions-aws-key.pub`) into this file. This file must be committed to your repository.

### 4. Review AMI ID and Region

Open `variables.tf` and verify that the `ami_id` is a valid Ubuntu 22.04 LTS AMI for your chosen `aws_region`.  
The default `aws_region` is `us-east-1`. If you change it, ensure you update the `TF_VAR_aws_region` environment variable in both `workflow.yml` and `destroy-workflow.yml`.

### 5. Commit and Push

Commit all the project files (including `.github/workflows/workflow.yml`, `.github/workflows/destroy-workflow.yml`, `main.tf`, `variables.tf`, `ansi.yml`, and `ssh-key.pub`) to your `main` branch.

---

## 🚀 Usage

This repository includes two GitHub Actions workflows:

### 1. Provision and Configure Infrastructure

- **Workflow File**: `.github/workflows/workflow.yml`
- **Purpose**: Launches an EC2 instance and installs Docker using Ansible.
- **Triggers**:
  - On every push to the `main` branch.
  - Manually via the "Actions" tab in your GitHub repository (look for "Terraform & Ansible Docker Install").

### 2. Destroy Infrastructure

- **Workflow File**: `.github/workflows/destroy-workflow.yml`
- **Purpose**: Tears down all AWS resources provisioned by Terraform.
- **Triggers**:
  - Manually only via the "Actions" tab in your GitHub repository (look for "Terraform Destroy Infrastructure").

> ⚠️ **WARNING**: This operation is permanent and will delete all associated resources. Use with caution!

---

## 📄 Project Structure
```
.
├── .github/
│   └── workflows/
│       ├── destroy-workflow.yml    # GitHub Actions workflow to destroy infrastructure
│       └── workflow.yml            # GitHub Actions workflow to provision and configure
├── ansi.yml                        # Ansible playbook for Docker installation
├── hosts.ini                       # Ansible inventory (dynamically generated by workflow)
├── main.tf                         # Terraform configuration for AWS infrastructure
├── variables.tf                    # Terraform variables
└── ssh-key.pub                     # Public SSH key used by Terraform (MUST be committed)
```
## Contributing
Feel free to fork this repository, open issues, or submit pull requests.

